{% extends 'base.html.twig' %}

{% block title %}{{ 'accounts.view.title'|trans }} · {{ 'app.name'|trans }}{% endblock %}

{% block body %}
    <section class="section">
        <div class="section__header">
            <div>
                <h1 class="page-title">{{ 'accounts.view.heading'|trans({'%name%': account_info.first_name ~ ' ' ~ account_info.last_name}) }}</h1>
                <p class="muted">
                    {{ account_info.email|default('—') }}
                    {% if account_info.phone %} · {{ account_info.phone }}{% endif %}
                    {% if account_info.city %} · {{ account_info.city }}, {{ account_info.state }} {{ account_info.zip }}{% endif %}
                </p>
            </div>
            <div class="grid" style="gap:0.5rem; grid-auto-flow:row;">
                <a class="button button--ghost" href="{{ path('app_account_edit', { aid: account_info.aid }) }}">{{ 'accounts.form.title_update'|trans }}</a>
                <a class="button button--ghost" href="{{ path('app_account_list') }}">{{ 'accounts.list.heading'|trans }}</a>
            </div>
        </div>

        {% if errors is not empty %}
            <div class="alert alert--error" role="alert">
                <ul>
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if messages is not empty %}
            <div class="alert alert--success" role="status">
                <ul>
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:1.5rem;">
            <div class="card">
                <h2>{{ 'accounts.view.upload_title'|trans }}</h2>
                <p class="muted">{{ 'accounts.view.upload_description'|trans }}</p>
                <form method="post" action="{{ path('app_account_view', { aid: account_info.aid }) }}" enctype="multipart/form-data" aria-describedby="account-upload-help">
                    <input type="hidden" name="upload" value="true">
                    <input type="hidden" name="_token" value="{{ csrf_token('account_upload') }}">
                    <div class="form-field">
                        <label for="html_file">{{ 'accounts.view.upload_label'|trans }}</label>
                        <input id="html_file" type="file" name="html_file" accept="text/html,text/htm,application/xhtml+xml" required>
                        <small id="account-upload-help">{{ 'report.upload.file_help'|trans }}</small>
                    </div>
                    <button class="button button--primary" type="submit" style="margin-top:1rem;">{{ 'accounts.view.submit'|trans }}</button>
                </form>
            </div>

            <div class="card">
                <h2>{{ 'accounts.view.files_title'|trans }}</h2>
                {% if files is not empty %}
                    <ul class="list list--files">
                        {% for file in files %}
                            <li>
                                <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem; flex-wrap:wrap;">
                                    <span>
                                        {{ file.filename }}<br>
                                        <small class="muted">{{ file.added|date('Y-m-d H:i') }}</small>
                                    </span>
                                    <a class="button button--ghost" href="{{ path('app_parse_html', { file: file.filename }) }}" target="_blank" rel="noopener">{{ 'accounts.view.download'|trans }}</a>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="muted">{{ 'accounts.view.list_empty'|trans }}</p>
                {% endif %}
            </div>

            <div class="card" style="grid-column: 1 / -1;">
                <h2>{{ 'accounts.view.info_title'|trans }}</h2>
                <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:1rem;">
                    <div>
                        <h3>{{ 'accounts.form.address_title'|trans }}</h3>
                        <p>
                            {{ account_info.first_name }} {{ account_info.last_name }}<br>
                            {{ account_info.address1|default('—') }}<br>
                            {% if account_info.address2 %}{{ account_info.address2 }}<br>{% endif %}
                            {{ account_info.city|default('') }}{% if account_info.city %}, {% endif %}{{ account_info.state }} {{ account_info.zip }}
                        </p>
                        <p class="muted">{{ account_info.email|default('—') }} · {{ account_info.phone|default('—') }}</p>
                    </div>
                    <div>
                        <h3>{{ 'accounts.form.credentials_title'|trans }}</h3>
                        <p>
                            <strong>{{ 'accounts.form.labels.credit_company'|trans }}:</strong> {{ account_info.credit_company|default('—') }}<br>
                            <strong>{{ 'accounts.form.labels.credit_company_user'|trans }}:</strong> {{ account_info.credit_company_user|default('—') }}<br>
                            <strong>{{ 'accounts.form.labels.credit_company_password'|trans }}:</strong>
                            {% if account_info.credit_company_password %}••••••{% else %}{{ 'accounts.view.info_missing'|trans }}{% endif %}<br>
                            <strong>{{ 'accounts.form.labels.credit_company_code'|trans }}:</strong> {{ account_info.credit_company_code|default('—') }}
                        </p>
                        {% if account_info.social %}
                            <p><strong>{{ 'accounts.form.labels.social'|trans }}:</strong> •••-••-{{ account_info.social }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
